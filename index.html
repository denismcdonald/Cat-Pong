<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Pong</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Monoton|Modak" rel="stylesheet">
</head>
<body>

        <div id="pong">
                <div id="pp">P</div>
                <div id="oo">O</div>
                <div id="nn">N</div>
                <div id="gg">G</div>
                <div id="ex">!</div>
            </div>

    <div id="umpire">
        <div id="leftear"></div>
        <div id="rightear"></div>
    </div>

    <div id="umpShirt"></div>
    <div id="tail"></div>
    <!-- <div id="leftFoot"></div>
    <div id="rightFoot"></div> -->

    <div id="eyeleft">
        <div id="shiny1"></div>
        <div id="eyebrowLeft"></div>
    </div>
    
    <div id="eyeright">
        <div id="shiny2"></div>
        <div id="tear"></div>
        <div id="eyebrowRight"></div>
    </div>

    <div id="nose">
        <div id="whiskers1"></div>
        <div id="whiskers2"></div>
        <div id="whiskers3"></div>
        <div id="whiskers4"></div>
        <div id="whiskers5"></div>
        <div id="whiskers6"></div>
    </div>
   
        <div id="p1Score">0</div>
        <div id="p2Score">0</div>

    <canvas id="gameCanvas" width="800" height="550"></canvas>

    <div id="ricoX"></div>
    <div id="ricoY"></div>

    <script type="text/javascript">

        var canvas;
        var ctx;
        var ballX = 400;
        var ballY = 300;
        var ballSpeedX = 10;        
        var ballSpeedY = 5;
        var rand = 5500;
        
        var player1Score = 0;
        var player2Score = 0;
        var winningScore = 3;

        var showingWinScreen = false;

        var paddle1Y = 250;
        var paddle2Y = 250;
        var paddleHeight = 100;
        var paddleWidth = 12;

        
        function calculateMousePosition(evt) {
            var rect = canvas.getBoundingClientRect();
            var root = document.documentElement;
            var mouseX = evt.clientX - rect.left - root.scrollLeft;
            var mouseY = evt.clientY - rect.top - root.scrollTop;
            return {
                x:mouseX,
                y:mouseY
            }            
        }; 

        function handleMouseClick() {
            if (showingWinScreen) {
                player1Score = 0;
                document.getElementById("p1Score").innerHTML = player1Score;
                player2Score = 0;
                document.getElementById("p2Score").innerHTML = player2Score;
                document.getElementById("p1Score").classList.remove("spin");
                document.getElementById("p2Score").classList.remove("spin");
                document.getElementById("tail").classList.remove("wag1");
                document.getElementById("tail").classList.remove("wag2");
                document.getElementById("tail").style.transform = "rotate(0deg)";
                showingWinScreen = false;
            }
        }


        window.onload = function() {
            canvas = document.getElementById("gameCanvas");
            ctx = canvas.getContext("2d");
            var framesPerSecond = 59;

            //Smooth animation method, as per https://css-tricks.com/using-requestanimationframe/
            function repeatOften() {
                moveEverything();
                drawEverything();
                requestAnimationFrame(repeatOften);
            }
            repeatOften();            

            //Previous animation method, as per tutorial
            // setInterval(function() {
            //     moveEverything();
            //     drawEverything();
            // }, 1000/framesPerSecond);

            canvas.addEventListener("mousedown", handleMouseClick);

            canvas.addEventListener("mousemove", 
                function(evt) {
                    var mousePos = calculateMousePosition(evt);
                    paddle1Y = mousePos.y-(paddleHeight/2);
            });

            //Blink cat's eyes
            setInterval(function blink() {
               document.getElementById("shiny1").style.visibility = "hidden";
               document.getElementById("shiny2").style.visibility = "hidden";
               document.getElementById("eyeleft").style.transition = "all 50ms ease-out";
               document.getElementById("eyeleft").style.height = "2px";
               document.getElementById("eyebrowLeft").style.transform = "skew(0,0deg)";
               document.getElementById("eyeright").style.transition = "all 50ms ease-out";
               document.getElementById("eyeright").style.height = "2px";
               document.getElementById("eyebrowRight").style.transform = "skew(0,0deg)";
               
               setTimeout(function() {
               document.getElementById("shiny1").style.visibility = "visible";
               document.getElementById("shiny2").style.visibility = "visible";
               document.getElementById("eyeleft").style.transition = "all 50ms ease-out";
               document.getElementById("eyeleft").style.height = "15px";
               document.getElementById("eyebrowLeft").style.transform = "skew(0,-20deg)";
               document.getElementById("eyeright").style.transition = "all 50ms ease-out";
               document.getElementById("eyeright").style.height = "15px";              
               document.getElementById("eyebrowRight").style.transform = "skew(0,20deg)";
               }, 150);
            }, rand);

        //Umpire mouseover
        // document.getElementById("umpire").addEventListener("mouseenter", function() {
//         document.getElementById("umpire").style.backgroundColor = "blue";
//         document.getElementById("umpire").classList.add("shake");
//         setTimeout(function() {
//            document.getElementById("umpire").classList.remove("shake");
//            }, 500);
//         });


        }  //window.onload 


        function ballReset() {      

            if (player1Score >= winningScore ||
                player2Score >= winningScore) {
                    document.getElementById("p1Score").innerHTML = player1Score;
                    document.getElementById("p2Score").innerHTML = player2Score;
                    showingWinScreen = true;
            }

            ballSpeedX = -ballSpeedX;
            ballSpeedY = ballSpeedY/3;
            ballX = canvas.width/2;
            ballY = canvas.height/2;

            //Umpire reaction
            document.getElementById("shiny1").style.visibility = "hidden";
            document.getElementById("shiny2").style.visibility = "hidden";
            document.getElementById("nose").style.top = "256px";
            document.getElementById("eyeleft").style.transition = "all 50ms ease-out";
            document.getElementById("eyeleft").style.height = "2px";
            document.getElementById("eyebrowLeft").style.transform = "skew(0,15deg)";
            document.getElementById("eyeright").style.transition = "all 50ms ease-out";
            document.getElementById("eyeright").style.height = "2px";
            document.getElementById("eyebrowRight").style.transform = "skew(0,-15deg)";

            setTimeout (function() {
                document.getElementById("shiny1").style.visibility = "visible";
                document.getElementById("shiny2").style.visibility = "visible";
                document.getElementById("nose").style.top = "265px";
                document.getElementById("eyeleft").style.transition = "all 50ms ease-out";
                document.getElementById("eyeleft").style.height = "15px";
                document.getElementById("eyebrowLeft").style.transform = "skew(0,-20deg)";
                document.getElementById("eyeright").style.transition = "all 50ms ease-out";
                document.getElementById("eyeright").style.height = "15px";
                document.getElementById("eyebrowRight").style.transform = "skew(0,20deg)";
            }, 600);  

        } //function ballReset


        function computerMovement() {
            
            var paddle2YCenter = paddle2Y + (paddleHeight/2);
            
            if (paddle2YCenter < ballY-35) {
                paddle2Y += 5;
            } else if (paddle2YCenter > ballY+35) {
                paddle2Y -= 5;
            }
        }


        function moveEverything() {

            if (showingWinScreen) {
                return;
            }

            computerMovement();

            ballX += ballSpeedX;
            ballY += ballSpeedY;
            
            if (ballX < 0) {

                //Horizontal ricochet hit detection
                document.getElementById("ricoX").style.visibility = "visible";
                document.getElementById("ricoX").style.left = canvas.offsetLeft + "px";
                document.getElementById("ricoX").style.top = canvas.offsetTop + ballY + "px";
                document.querySelector("canvas").style.border = "8px solid black";
                //Ricochet hit detection keyframes animation test
                // document.getElementById("ricoX").classList.add("shakeWith");
                // setTimeout(function() {
                //     document.getElementById("ricoX").classList.remove("shakeWith");
                // }, 500);
                
                
                if (ballY > paddle1Y-10 && ballY < paddle1Y+paddleHeight+10) {
                    ballSpeedX = -ballSpeedX;
               
                    //Calculates variable ball speed depending on collision point with paddle
                    var deltaY = ballY-(paddle1Y+paddleHeight/2);
                    ballSpeedY = deltaY * 0.35;

                } else {     
                    player2Score++;  
                    ballReset();
                    document.getElementById("p2Score").innerHTML = player2Score;

                    //Tail TEST
                    document.getElementById("tail").style.transform = "rotate(15deg)";
                    
                    document.getElementById("p2Score").classList.add("grow");
                    setTimeout(function() {
                        document.getElementById("p2Score").classList.remove("grow");
                    }, 2000);
                   
                    document.querySelector("canvas").classList.add("shake");
                    setTimeout(function() {
                        document.querySelector("canvas").classList.remove("shake");
                    }, 1000);
                }
            }

            if (ballX > canvas.width) {

                //Horizontal ricochet hit detection
                document.getElementById("ricoX").style.visibility = "visible";
                document.getElementById("ricoX").style.left = canvas.offsetLeft + canvas.width+7 + "px";
                document.getElementById("ricoX").style.top = canvas.offsetTop + ballY + "px";
                document.querySelector("canvas").style.border = "8px solid #2cc715";
                
                if (ballY > paddle2Y && ballY < paddle2Y+paddleHeight) {
                    ballSpeedX = -ballSpeedX;
                    
                    var deltaY = ballY-(paddle2Y+paddleHeight/2);
                    ballSpeedY = deltaY * 0.35;

                } else {                
                    player1Score++;
                    ballReset();
                    document.getElementById("p1Score").innerHTML = player1Score;

                    //Tail TEST
                    document.getElementById("tail").style.transform = "rotate(-15deg)";
                                        
                    document.getElementById("p1Score").classList.add("grow");
                    setTimeout(function() {
                        document.getElementById("p1Score").classList.remove("grow");
                    }, 2000);

                    document.querySelector("canvas").classList.add("cheer");
                    setTimeout(function() {
                        document.querySelector("canvas").classList.remove("cheer");
                    }, 1000);
                }
            }
            
            if (ballY <= 0) {
                ballSpeedY = -ballSpeedY;
                
                //Vertical ricochet hit detection
                document.getElementById("ricoY").style.visibility = "visible";
                document.getElementById("ricoY").style.top = canvas.offsetTop + "px";
                document.getElementById("ricoY").style.left = canvas.offsetLeft + ballX + "px";                
                document.querySelector("canvas").style.border = "8px solid yellow";
            }
            if (ballY > canvas.height) {
                ballSpeedY = -ballSpeedY;
                
                console.log(canvas.width);
                //Vertical ricochet hit detection
                document.getElementById("ricoY").style.top = canvas.offsetTop + canvas.height+6 + "px";
                document.getElementById("ricoY").style.left = canvas.offsetLeft + ballX + "px"; 
                document.getElementById("ricoY").style.visibility = "visible"; 
                document.querySelector("canvas").style.border = "8px solid #ff0080"; 
            }
            
            //Umpire eyes track ball
            if (ballX < 400) {
                // document.getElementById("eyeleft").style.left = "49%";
                // document.getElementById("nose").style.left = "48.85%";
                // document.getElementById("eyeright").style.left = "49%";
                document.getElementById("eyeleft").style.marginLeft = "-35px"; 
                document.getElementById("nose").style.marginLeft = "-17px";  
                document.getElementById("eyeright").style.marginLeft = "3px";
            }
            if (ballX > 400) {
                // document.getElementById("eyeleft").style.left = "51%"; 
                // document.getElementById("nose").style.left = "50%";  
                // document.getElementById("eyeright").style.left = "50.75%";          
                document.getElementById("eyeleft").style.marginLeft = "-20px"; 
                document.getElementById("nose").style.marginLeft = "0px";  
                document.getElementById("eyeright").style.marginLeft = "18px";   
            }
          
            //Eyes track ball on widescreen
            // if (window.matchMedia("(min-width: 1500px)").matches) {
            //     if (ballX < 400) {
            //     document.getElementById("eyeleft").style.left = "48.50%";
            //     document.getElementById("nose").style.left = "49.40%";
            //     }
            //     if (ballX > 400) {
            //     document.getElementById("eyeleft").style.left = "49%";
            //     document.getElementById("eyeright").style.left = "51%";             
            //     }               
            // }

             //Eyes track ball on smaller screens
            //  if (window.matchMedia("(max-width: 1100px)").matches) {
            //     if (ballX < 400) {
            //     document.getElementById("eyeleft").style.left = "46.75%";
            //     document.getElementById("nose").style.left = "48.5%";
            //     }
            //     if (ballX > 400) {
            //     document.getElementById("eyeleft").style.left = "48.25%";  
            //     document.getElementById("eyeright").style.left = "51.5%";           
            //     }               
            // }

        } //function moveEverything


        function drawEverything() {
            
            //Canvas play area
            colorRect(0, 0, canvas.width, canvas.height, "#7447d1");

              if (showingWinScreen) {
                ctx.fillStyle = "yellow";
                ctx.font = "30px Monoton";

                if (player1Score >= winningScore) {
                    ctx.fillText("Victory!", 330, 250);
                    document.getElementById("p1Score").classList.add("spin");
                    document.getElementById("tail").classList.add("wag1");
            
                } else if (player2Score >= winningScore) {
                    ctx.fillText("Alas!", 340, 250);
                    document.getElementById("p2Score").classList.add("spin");
                    document.getElementById("tail").classList.add("wag2");
                }               
                  
                ctx.fillText("Click to play again...", 230, 350);
                  
                //PONG lettering TEST
                setTimeout(function() {
                    document.getElementById("pp").classList.add("popin");
                },500);

                setTimeout(function() {
                    document.getElementById("oo").classList.add("popin");
                },1000);

                setTimeout(function() {
                    document.getElementById("nn").classList.add("popin");
                },500);

                setTimeout(function() {
                    document.getElementById("gg").classList.add("popin");
                },1000);

                setTimeout(function() {
                    document.getElementById("ex").classList.add("popin");
                },500);

                document.getElementById("eyeleft").style.marginLeft = "-30px";
                document.getElementById("nose").style.marginLeft = "-10px";
                document.getElementById("eyeright").style.marginLeft = "10px";
                
                

            

                // if (window.matchMedia("(min-width: 1700px)").matches) {
                //     document.getElementById("eyeleft").style.left = "48.5%";
                //     document.getElementById("eyeright").style.left = "50.5%";
                // }
                return;
              }

            //Ball
            colorCircle(ballX, ballY, 10, "black");
            colorCircle(ballX, ballY, 8, "white");
           
            //Paddle left
            colorRect(0, paddle1Y, paddleWidth, paddleHeight, "yellow");

            //Paddle left border
            // colorRect(0, paddle1Y+4, paddleWidth-4, paddleHeight-8, "black");
           
            //Paddle right
            colorRect(canvas.width-11, paddle2Y, paddleWidth, paddleHeight, "yellow");

            //Paddle right border
            // colorRect(canvas.width-8, paddle2Y+4, paddleWidth, paddleHeight-8, "black");
         
            //Net
            ctx.strokeStyle = "white";
            ctx.beginPath();
            ctx.setLineDash([10,15]);
            ctx.moveTo(400,580);
            ctx.lineTo(400,20);
            ctx.stroke();
            ctx.fill();           


        } //function drawEverything
   
        //Circle draw template
        function colorCircle(centerX, centerY, radius, drawColor) {
            ctx.fillStyle = drawColor;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI*2, true);
            ctx.fill();
        }

        //Rectangle draw template
        function colorRect(leftX, topY, width, height, drawColor) {
            ctx.fillStyle = drawColor;
            ctx.fillRect(leftX, topY, width, height);
        }


        // PONG lettering
        setTimeout(function() {
            document.getElementById("pp").classList.add("popin");
        },500);

        setTimeout(function() {
            document.getElementById("oo").classList.add("popin");
        },1000);

        setTimeout(function() {
            document.getElementById("nn").classList.add("popin");
        },500);

        setTimeout(function() {
            document.getElementById("gg").classList.add("popin");
        },1000);

        setTimeout(function() {
            document.getElementById("ex").classList.add("popin");
        },500);
      
    
    </script>

</body>
</html>