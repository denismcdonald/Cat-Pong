<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Pong</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

    <div id="umpire"></div>

    <div id="eyeleft">
        <div id="eyebrowLeft"></div>
    </div>
    <div id="eyeright">
        <div id="eyebrowRight"></div>
    </div>
    <div id="nose">
        <div id="whiskers1"></div>
        <div id="whiskers2"></div>
        <div id="whiskers3"></div>
        <div id="whiskers4"></div>
        <div id="whiskers5"></div>
        <div id="whiskers6"></div>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script type="text/javascript">

        var canvas;
        var ctx;
        var ballX = 50;
        var ballSpeedX = 10;        
        var rand = Math.floor(Math.random() * (10000 - 1000 + 1) + 1000);

       
        window.onload = function() {
            canvas = document.getElementById("gameCanvas");
            ctx = canvas.getContext("2d");

            var framesPerSecond = 59;

            //Smooth animation method, as per https://css-tricks.com/using-requestanimationframe/
            function repeatOften() {
                moveEverything();
                drawEverything();
                requestAnimationFrame(repeatOften);
            }
            repeatOften();            

            //Previous animation method, as per Udemy tutorial
            // setInterval(function() {
            //     moveEverything();
            //     drawEverything();
            // }, 1000/framesPerSecond);


            //Blink cat's eyes
            setInterval(function() {

               console.log("blink");
               document.getElementById("eyeleft").style.transition = "all 50ms ease-out";
               document.getElementById("eyeleft").style.height = "2px";
               document.getElementById("eyebrowLeft").style.transform = "skew(0,0deg)";
               document.getElementById("eyeright").style.transition = "all 50ms ease-out";
               document.getElementById("eyeright").style.height = "2px";
               document.getElementById("eyebrowRight").style.transform = "skew(0,0deg)";
               
               setTimeout(function() {
               document.getElementById("eyeleft").style.height = "15px";
               document.getElementById("eyeleft").style.transition = "all 50ms ease-out";
               document.getElementById("eyebrowLeft").style.transform = "skew(0,-20deg)";
               document.getElementById("eyeright").style.height = "15px";
               document.getElementById("eyeright").style.transition = "all 50ms ease-out";
               document.getElementById("eyebrowRight").style.transform = "skew(0,20deg)";
               }, 100);
            }, rand);
        }   


        //Perhaps try implementing setTimeout for random interval instead?  https://stackoverflow.com/questions/30725455/change-setinterval-value-dynamically

        function moveEverything() {
            ballX = ballX + ballSpeedX;
            if (ballX > canvas.width) {
                ballSpeedX = -ballSpeedX;
            }
            if (ballX < 0) {
                ballSpeedX = -ballSpeedX;
            }
            
            //Cateyes
            if (ballX < 400) {
                document.getElementById("eyeleft").style.left = "47.5%";
                document.getElementById("nose").style.left = "49%";
            }
            if (ballX > 400) {
                document.getElementById("eyeleft").style.left = "48.5%"; 
                document.getElementById("nose").style.left = "50%";           
            }
            if (ballX < 400) {
                document.getElementById("eyeright").style.left = "50.5%";
            }
            if (ballX > 400) {
                document.getElementById("eyeright").style.left = "51.5%";            
            }
        }

        function drawEverything() {
            
            //Canvas play area
            colorRect(0, 0, canvas.width, canvas.height, "purple");
           
            //Paddle left
            colorRect(0, 250, 10, 100, "yellow");
           
            //Paddle right
            colorRect(790, 250, 10, 100, "yellow");
         
            //Net
            ctx.strokeStyle = "white";
            ctx.beginPath();
            ctx.setLineDash([10,15]);
            ctx.moveTo(400,580);
            ctx.lineTo(400,20);
            ctx.stroke();
            ctx.fill();
           
            //Ball
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(ballX,300,8,0,2 * Math.PI, false);
            ctx.stroke();
            ctx.fill();
        }

        //Rectangle draw template
        function colorRect(leftX, topY, width, height, drawColor) {
            ctx.fillStyle = drawColor;
            ctx.fillRect(leftX, topY, width, height);
        }
    
    </script>

</body>
</html>